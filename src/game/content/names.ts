import type { Gender } from "../types"

const capitalize = (s: string) => s.charAt(0).toUpperCase() + s.slice(1)

const GIVEN: Record<Gender, string[]> = {
	male: [
	"Aaron",
	"Adam",
	"Aiden",
	"Airo",
	"Alex",
	"Alexey",
	"Amar",
	"Ander",
	"Andrew",
	"Aren",
	"Arlo",
	"Ash",
	"Aster",
	"Ben",
	"Benj",
	"Benno",
	"Benoit",
	"Brandon",
	"Cal",
	"Caleb",
	"Cole",
	"Daniel",
	"Dane",
	"Dante",
	"Dominic",
	"David",
	"Dylan",
	"Eli",
	"Elio",
	"Eren",
	"Ethan",
	"Evan",
	"Gabriel",
	"Griffin",
	"Gino",
	"Henry",
	"Isaac",
	"Iso",
	"Jacob",
	"Jalen",
	"James",
	"Jason",
	"Jakob",
	"Jean",
	"Jonah",
	"Jordan",
	"Josh",
	"Joshua",
	"Julian",
	"Kael",
	"Keenan",
	"Key",
	"Kian",
	"Lee",
	"Leo",
	"Liam",
	"Lucan",
	"Lucas",
	"Mark",
	"Matix",
	"Matthew",
	"Matt",
	"Max",
	"Micah",
	"Miles",
	"Miro",
	"Nash",
	"Nathan",
	"Neo",
	"Nikolas",
	"Niko",
	"Noah",
	"Noel",
	"Oliver",
	"Owen",
	"Paul",
	"Reed",
	"Reid",
	"Rex",
	"Ross",
	"Roy",
	"Ryan",
	"Ryker",
	"Ryn",
	"Sam",
	"Sebastian",
	"Soren",
	"Theo",
	"Thomas",
	"Vano",
	"Victor",
	"Vik",
	"Viktor",
	"Vincent",
	"Vinnie",
	"Will",
	"William",
	"Wyatt",
	"Yoru",
	"Yuri",
	"Yusuf",
	"Zane",
	"Zen",
	"Zeph"
	],
  female: [
	"Abigail",
	"Aisha",
	"Ashanti",
	"Alana",
	"Alex",
	"Alice",
	"Amara",
	"Amelia",
	"Anika",
	"Aria",
	"Ava",
	"Bea",
	"Bella",
	"Brianna",
	"Brie",
	"Brooke",
	"Camila",
	"Carol",
	"Caroline",
	"Chars",
	"Charlotte",
	"Chloe",
	"Clara",
	"Claire",
	"Dalia",
	"Elain",
	"Elena",
	"Eliza",
	"Ella",
	"Ellie",
	"Emily",
	"Esme",
	"Eva",
	"Fio",
	"Fiona",
	"Freya",
	"Gabrielle",
	"Gab",
	"Grace",
	"Hannah",
	"Hanako",
	"Hazel",
	"Iris",
	"Isabel",
	"Ives",
	"Jade",
	"Jasmine",
	"Jean",
	"Josephine",
	"Julia",
	"Julie",
	"Juno",
	"Kaia",
	"Kara",
	"Layla",
	"Leah",
	"Lena",
	"Lian",
	"Lila",
	"Lyla",
	"Lynn",
	"Lucy",
	"Luna",
	"Maeve",
	"Mauve",
	"Maya",
	"Mila",
	"Mira",
	"Mirai",
	"Mina",
	"Moon",
	"Naomi",
	"Nina",
	"Nora",
	"Olive",
	"Olivia",
	"Penelope",
	"Phoebe",
	"Quinn",
	"Rhea",
	"Riley",
	"Rose",
	"Ruby",
	"Sabrina",
	"Sadie",
	"Selene",
	"Selena",
	"Sienna",
	"Silva",
	"Sofia",
	"Stell",
	"Stella",
	"Talia",
	"Thea",
	"Vera",
	"Violet",
	"Willa",
	"Willow",
	"Xena",
	"Yara",
	"Zara",
	"Zoe",
	"Ziva"
	],
  // removed neutral pool â€” using male/female only for now
}

const FAMILY: string[] = [
  "gale",
  "trace",
  "mercer",
  "voss",
  "vale",
  "kellan",
  "torque",
  "crane",
  "sable",
  "locke",
  "holt",
  "marlow",
  "hale",
  "mori",
  "canto",
  "vega",
  "rowe",
  "cross",
  "dane",
  "mercer",
  "knox",
  "breaker",
  "flint",
  "ward",
  "ire",
  "nova",
  "quinn",
  "torne",
  "lynch",
  "frost",
  "oak",
  "price",
  "reed",
  "evans",
  "shaw",
  "doyle",
  "myers",
  "cross",
  "dane",
  "lyons",
  "york",
  "seun",
  "saito",
  "takeda",
  "hayashi",
  "kuroda",
  "matsuda",
  "tanaka",
  "ito",
  "shimizu",
  "fukuda",
  "okada",
  "honda",
]

type NamePickOptions = {
  gender?: Gender | null
  tags?: string[]
  fallbackFirst?: string[]
  fallbackLast?: string[]
}

const pick = <T,>(arr: T[] | undefined, rng: () => number): T | undefined => {
  if (!arr || arr.length === 0) return undefined
  return arr[Math.floor(rng() * arr.length)]
}

const pickGiven = (rng: () => number, gender?: Gender | null) => {
	const genderPool = gender && GIVEN[gender] ? GIVEN[gender] : undefined
	const chosen = pick(genderPool, rng) ?? pick(GIVEN.male, rng)
	return capitalize(chosen ?? "Alex")
}

const pickFamily = (rng: () => number) => capitalize(pick(FAMILY, rng) ?? "Doe")

export const pickName = (
	rng: () => number,
	opts: NamePickOptions & { gender?: Gender | null }
): { first: string; last: string } => {
	const first = pickGiven(rng, opts.gender) ?? capitalize(pick(opts.fallbackFirst, rng) ?? "Alex")
	const last = pickFamily(rng) ?? capitalize(pick(opts.fallbackLast, rng) ?? "Doe")
	return { first, last }
}

export default { pickName }

// Resolve a named group key (e.g. "mechanic_male") to a first-name pool.
// Currently groups ending with "_male", "_female", or "_neutral" map to the
// corresponding GIVEN pools. Unknown groups fallback to the neutral pool.
export const resolveNameGroupFirst = (groupKey?: string): string[] | undefined => {
	if (!groupKey) return undefined
	const k = groupKey.toLowerCase()
	if (k === "male" || k.endsWith("_male")) return GIVEN.male
	if (k === "female" || k.endsWith("_female")) return GIVEN.female
	// fallback to male if unknown
	return GIVEN.male
}
